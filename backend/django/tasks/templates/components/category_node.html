<li class="list-group-item" id="category-node-{{ category.id }}">
  <div class="d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center">
      {% if category.subcategories.exists %}
      <button
        class="btn btn-sm btn-outline-secondary me-2"
        type="button"
        onclick="toggleSubcategories({{ category.id }})"
      >
        <span id="toggle-icon-{{ category.id }}">▶</span>
      </button>
      {% endif %}
      <span
        class="fw-bold"
        style="cursor: pointer"
        hx-get="{% url 'category_details_view' category.id %}"
        hx-target="#task-details"
        hx-swap="innerHTML"
      >
        {{ category.name }}
      </span>
    </div>
    <div class="btn-group" role="group">
      <button
        class="btn btn-sm btn-outline-primary"
        hx-get="{% url 'category_create_form_with_parent' category.id %}"
        hx-target="#htmxModalBody"
        hx-swap="innerHTML"
        data-bs-toggle="modal"
        data-bs-target="#htmxModal"
        title="Añadir subcategoría"
      >
        Añadir
      </button>
      <button
        class="btn btn-sm btn-warning"
        hx-get="{% url 'category_edit_form' category.id %}"
        hx-target="#htmxModalBody"
        hx-swap="innerHTML"
        data-bs-toggle="modal"
        data-bs-target="#htmxModal"
        title="Editar"
      >
        Editar
      </button>
      <button
        class="btn btn-sm btn-danger"
        hx-delete="{% url 'category_delete' category.id %}"
        hx-confirm="¿Estás seguro de que quieres eliminar esta categoría y todas sus subcategorías?"
        hx-target="#category-node-{{ category.id }}"
        hx-swap="outerHTML"
        hx-on::after-request="htmx.trigger(document.body, 'categoryDeleted')"
        title="Eliminar"
      >
        Eliminar
      </button>
    </div>
  </div>
  {% if category.subcategories.exists %}
  <ul
    class="list-group mt-2 ms-3"
    id="subcategories-{{ category.id }}"
    style="display: none"
  >
    {% for subcategory in category.subcategories.all %} {% include 'components/category_node.html' with category=subcategory %} {% endfor %}
  </ul>
  {% endif %}
</li>

<script>
  function toggleSubcategories(categoryId) {
    const subcategoriesElement = document.getElementById(
      "subcategories-" + categoryId,
    );
    const toggleIcon = document.getElementById("toggle-icon-" + categoryId);

    if (subcategoriesElement.style.display === "none") {
      subcategoriesElement.style.display = "block";
      toggleIcon.textContent = "▼";
    } else {
      subcategoriesElement.style.display = "none";
      toggleIcon.textContent = "▶";
    }
  }
</script>
